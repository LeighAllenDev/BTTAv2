{% extends 'base.html' %}
{% url 'account_login' as login_url %}
{% url 'account_signup' as signup_url %}
{% block content %}

<h1>Book Your Visit Now!</h1>

<p>Choose from our bundles,<br>
    select your desired food and drinks,<br>
    then confirm your booking.<br>
    We look forward to seeing you soon!</p>

{% if user.is_authenticated %}
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <div id="token-info"></div>
    <button type="submit">Book Now</button>
</form>
{% else %}
<p>Please <a href="{% url 'account_login' %}?next={{ request.path }}">sign in</a> or <a href="{% url 'account_signup' %}">register</a> to make a booking.</p>
{% endif %}

<script>
    // Assume an endpoint /api/bundles/<id>/ provides bundle token information
    // And /api/categories/ provides token costs for categories
    
    let foodTokens = 0;
    let drinkTokens = 0;
    
    document.getElementById('id_bundle').addEventListener('change', function() {
        const bundleId = this.value;
        fetch(`/api/bundles/${bundleId}/`)
            .then(response => response.json())
            .then(bundle => {
                foodTokens = bundle.food_tokens; // Update global token counts
                drinkTokens = bundle.drink_tokens;
                updateFormForBundle(bundle); // Implement this function to adjust form
            });
    });
    
    function updateFormForBundle(bundle) {
        // Example: Show available tokens in the UI
        document.getElementById('food-tokens-available').textContent = `Food Tokens Available: ${foodTokens}`;
        document.getElementById('drink-tokens-available').textContent = `Drink Tokens Available: ${drinkTokens}`;
    
        // Fetch categories and their token costs, then update the UI
        // to let the user make selections until tokens run out.
    }
    </script>
    
{% endblock %}